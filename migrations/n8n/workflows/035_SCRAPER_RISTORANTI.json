{
  "updatedAt": "2025-03-11T12:23:17.000Z",
  "createdAt": "2025-03-11T01:20:31.311Z",
  "id": "IkSQQfPN8UGG5iLJ",
  "name": "SCRAPER RISTORANTI",
  "description": null,
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "text": "={{ $json.reviews }}",
        "attributes": {
          "attributes": [
            {
              "name": "analisi",
              "description": "Fammi un analisi dettagliata delle recensioni e successivamente dammi dei consigli per migliorare"
            },
            {
              "name": "Numero_recensioni_analizzate",
              "description": "il numero delle recensioni analizzate "
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1,
      "position": [
        1160,
        0
      ],
      "id": "5b67d116-b8a8-418d-ae9d-ece97ad93297",
      "name": "Information Extractor"
    },
    {
      "parameters": {
        "model": "openai/o3-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1120,
        220
      ],
      "id": "9654d324-0eba-4092-9e48-ef2e907b2cf2",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "DIaCgMCJChhjSXPT",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://serpapi.com/search.json?engine=google_maps&q={{ $json['Nome ristorante '] }}+{{ $json['Posizione Ristorante'] }}&api_key=08af7ec999eae526041620622a47e8bab749fc092e7239e8eff2258eacbdf114",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        260,
        0
      ],
      "id": "082dffc6-e402-4ece-a9c2-768458ce0784",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "url": "=https://serpapi.com/search.json?engine=google_maps_reviews&place_id={{ $json.place_results.place_id }}&api_key=08af7ec999eae526041620622a47e8bab749fc092e7239e8eff2258eacbdf114",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        720,
        0
      ],
      "id": "89cf8feb-90c3-488f-b790-eb142fc8fdc0",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "66ce1725-57e1-4f06-8e2d-e910c7cd12ba",
              "name": "reviews",
              "value": "={{ $json.reviews }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        880,
        0
      ],
      "id": "c7eab52b-f3d9-4b89-b171-68fd949d4774",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "formTitle": "Valutazione ristorante",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Nome ristorante ",
              "requiredField": true
            },
            {
              "fieldLabel": "Posizione Ristorante",
              "requiredField": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        0,
        0
      ],
      "id": "019c3e8e-53d0-4083-84c0-ba02ee55a67c",
      "name": "On form submission",
      "webhookId": "8eb51073-bb46-4db8-8275-325a2c72b81f"
    },
    {
      "parameters": {
        "command": "=node -e \"const puppeteer = require('puppeteer'); async function getReviews(placeId) { const browser = await puppeteer.launch({ headless: true, args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage', '--disable-gpu'] }); const page = await browser.newPage(); const url = \\`https://www.google.com/maps/place/?q=place_id:${placeId}\\`; await page.goto(url, { waitUntil: 'domcontentloaded' }); await page.waitForSelector('.section-review', { timeout: 60000 }); let reviews = []; let currentPage = 0; let maxPages = 2; while (currentPage < maxPages) { const pageReviews = await page.evaluate(() => { const reviewElements = Array.from(document.querySelectorAll('.section-review')); return reviewElements.map(el => ({ user: el.querySelector('.section-review-title span')?.innerText, rating: el.querySelector('.section-review-stars')?.getAttribute('aria-label'), text: el.querySelector('.section-review-text')?.innerText, date: el.querySelector('.section-review-publish-date')?.innerText })); }); reviews = [...reviews, ...pageReviews]; const nextButton = await page.$('.section-pagination-button-next'); if (nextButton) { await nextButton.click(); await page.waitForTimeout(2000); currentPage++; } else { break; } } console.log(JSON.stringify(reviews)); await browser.close(); } const placeId = '{{ $json.place_results.place_id }}'; getReviews(placeId).catch(console.error);\""
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        460,
        0
      ],
      "id": "a891d8df-70fe-4c45-87db-27b7a167f584",
      "name": "Execute Command"
    }
  ],
  "connections": {
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Information Extractor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Execute Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Information Extractor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "On form submission": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command": {
      "main": [
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "6a5d1102-569c-42a6-8ef4-782e6d29edaf",
  "activeVersionId": null,
  "versionCounter": 1,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-03-11T01:20:31.315Z",
      "createdAt": "2025-03-11T01:20:31.315Z",
      "role": "workflow:owner",
      "workflowId": "IkSQQfPN8UGG5iLJ",
      "projectId": "0AmEo4NBEOscZ3Iq",
      "project": {
        "updatedAt": "2024-10-14T23:37:33.647Z",
        "createdAt": "2024-10-14T23:37:33.647Z",
        "id": "0AmEo4NBEOscZ3Iq",
        "name": "raffaele lugibello <raffaelelugibello@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "updatedAt": "2024-10-14T23:37:33.649Z",
            "createdAt": "2024-10-14T23:37:33.649Z",
            "userId": "92cb5655-bd06-47de-bace-3df5438bc30e",
            "projectId": "0AmEo4NBEOscZ3Iq",
            "user": {
              "updatedAt": "2026-01-27T14:16:12.000Z",
              "createdAt": "2024-05-22T00:23:19.904Z",
              "id": "92cb5655-bd06-47de-bace-3df5438bc30e",
              "email": "raffaelelugibello@gmail.com",
              "firstName": "raffaele",
              "lastName": "lugibello",
              "personalizationAnswers": {
                "companyType": "personal",
                "reportedSource": "google",
                "version": "v4",
                "personalization_survey_submitted_at": "2024-05-22T01:09:14.581Z",
                "personalization_survey_n8n_version": "1.41.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "yaoggJbM3me6df8R",
                "isOnboarded": true,
                "userActivatedAt": 1728949053911,
                "npsSurvey": {
                  "waitingForResponse": true,
                  "ignoredCount": 1,
                  "lastShownAt": 1768926632479
                },
                "easyAIWorkflowOnboarded": true
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-01-26",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": null
}
